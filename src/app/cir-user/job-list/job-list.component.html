<div class="job-list-container">
  <div class="header">
    <div class="header-left">
      <h2>{{projectName ? projectName + ' - Jobs' : 'Jobs'}}</h2>
    </div>
    <div class="header-right">
      <button class="back-button" (click)="goBack()" title="Back to Projects">
        <i class="fas fa-arrow-left"></i>
        <span>Back to Projects</span>
      </button>
    </div>
  </div>

  <div class="project-info-section" *ngIf="projectDetails">
    <div class="project-details">
      <!-- <div class="detail-item">
        <span class="detail-key">Client:</span>
        <span class="detail-value">{{projectDetails.client}}</span>
      </div> -->
      <div class="detail-item">
        <span class="detail-key">Location:</span>
        <span class="detail-value">{{projectDetails.clientLocation}}</span>
      </div>
      <div class="detail-item">
        <span class="detail-key">Work Type:</span>
        <span class="detail-value">{{projectDetails.workType}}</span>
      </div>
      <div class="detail-item">
        <span class="detail-key">Status:</span>
        <span class="detail-value status-value" style="width: 120px;" [ngClass]="getStatusClass(projectDetails?.status)">
          {{projectDetails.status}}
        </span>
      </div>
      <div class="detail-item">
        <span class="detail-key">Positions:</span>
        <span class="detail-value">{{projectDetails.noOfPositions}}</span>
      </div>
      <div class="detail-item">
        <span class="detail-key">Day Rates:</span>
        <span class="detail-value">
          ${{projectDetails.dayRatesRange?.min | number}} - ${{projectDetails.dayRatesRange?.max | number}}
        </span>
      </div>
      <div class="detail-item clearance-item" *ngIf="projectDetails.clearanceOrCertifications?.length">
        <span class="detail-key">Clearance/Certifications:</span>
        <div class="clearance-tags">
          <span class="clearance-tag" *ngFor="let clearance of projectDetails.clearanceOrCertifications">
            {{clearance}}
          </span>
        </div>
      </div>
    </div>
  </div>

  <div class="search-filter">
    <input type="text" placeholder="Search jobs..." class="search-input" [(ngModel)]="searchText" (input)="searchtext()">
    <select class="filter-select" [(ngModel)]="selectedStatus" (change)="searchtext()">
      <option value="">All Job Types</option>
      <option *ngFor="let status of statusList" [value]="status">{{status}}</option>
    </select>
    <select class="filter-select" [(ngModel)]="selectedFilterStatus" (change)="applyStatusFilter()">
      <option value="">All Status</option>
      <option value="Applied">Applied</option>
      <option value="Expired">Expired</option>
      <option value="Active">Active</option>
      <option value="Under Review">Under Review</option>
      <option value="Actioned">Actioned</option>
      <option value="Inactive">Inactive</option>
    </select>
  </div>

  <!-- Expired Project Message -->
  <div *ngIf="isProjectExpired()" class="expired-project-message">
    <div class="message-container">
      <div class="icon-wrapper">
        <div class="icon">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
      </div>
      <h3>Project Expired</h3>
      <p>This project has expired and is no longer accepting applications. All job positions are now closed.</p>
    </div>
  </div>

  <!-- Active Project Message -->
  <div *ngIf="isProjectActive()" class="active-project-message">
    <div class="message-container">
      <div class="icon-wrapper">
        <div class="icon">
          <i class="fas fa-check-circle"></i>
        </div>
      </div>
      <h3>Project Active</h3>
      <p>This project is currently active and accepting applications. You can apply for available job positions.</p>
    </div>
  </div>

  <!-- Future Role Project Message -->
  <div *ngIf="isProjectFutureRole()" class="future-role-message">
    <div class="message-container">
      <div class="icon-wrapper">
        <div class="icon">
          <i class="fas fa-info-circle"></i>
        </div>
      </div>
      <h3>Important Notice</h3>
      <p>It is important for you to read the Read me document for each job title before you take action.</p>
    </div>
  </div>

  <div class="table-container">
    <table class="jobs-table">
      <thead>
        <tr>
          <th>Job ID</th>
          <th>Job Title</th>
          <th>No. of Roles</th>
          <th>Publish Date</th>
          <th>Apply By</th>
          <th>Status</th>
          <th>Role Details</th>
          <th>Apply Job</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngIf="jobList.length == 0">
          <td colspan="7" class="text-center">No Record Found.</td>
        </tr>
        <tr *ngFor="let job of jobList | paginate: { itemsPerPage: pagesize, currentPage: page, totalItems: totalRecords }">
          <td>{{job.job_id}}</td>
          <td>{{job.job_title}}</td>
          <td>{{job.no_of_roles}}</td>
          <td>{{job.publish_date | date:'dd/MM/yyyy'}}</td>
          <td>
            <ng-container *ngIf="!job?.cirextendJobDetails?.job_expire_date">
              {{job?.jobExpireDate | date:'dd/MM/yyyy'}}
            </ng-container>
            <ng-container *ngIf="job?.cirextendJobDetails?.job_expire_date">
              {{job?.cirextendJobDetails?.job_expire_date | date:'dd/MM/yyyy'}}
            </ng-container>
          </td>
          <td>
            <span class="status-badge" [ngClass]="getJobStatus(job).toLowerCase().replace(' ', '-')">
              {{getJobStatus(job)}}
            </span>
          </td>
          <td> <a href="{{job?.upload?.url}}" target="_blank" class="action-btn read-me">Read Me</a></td>
          <td class="actions">
            <ng-container *ngIf="job.status !== 'Under Review'; else emailMessage">
              <div *ngIf="!job.applied">
                <button class="action-btn apply"
                  [disabled]="job.status === 'Applied' || job.status === 'Expired' || job.status === 'Inactive' || isProjectExpired()"
                  (click)="openModal(job)">
                  <span *ngIf="isProjectFutureRole()" [ngbTooltip]="'Applications are closed, due date crossed.'">Apply</span>
                  <span *ngIf="!isProjectFutureRole()">Apply</span>
                </button>
              </div>
              <div *ngIf="job.applied == true">
                <button class="action-btn upload"
                  [disabled]="job.status === 'Not Submitted' || isProjectExpired()"
                  (click)="openCVModal(job)">
                  Upload CV
                </button>
              </div>
            </ng-container>
            <ng-template #emailMessage>
              <span class="email-message">Email CVs to: jamie.thompson@saivensolutions.co.uk</span>
            </ng-template>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="pagination">
    <pagination-controls (pageChange)="paginate($event)"></pagination-controls>
  </div>
</div>

<!-- Apply Job Modal -->
<ng-template class="modal" #loginDetailModal id="loginDetailModal" tabindex="-1" aria-labelledby="ViewLogin" aria-hidden="true">
  <div class="modal-overlay" (click)="closeModal()"></div>
  <div class="modal-container">
    <div class="modal-header">
      <h5 class="modal-title" id="ViewLogin">Upload Details</h5>
      <button type="button" class="close-btn" (click)="closeModal()" title="Close">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <form [formGroup]="resourcesForm">
        <!-- CV Option Section -->
        <div class="form-section">
          <div class="form-group">
            <label class="form-label">
              Choose CV option: <span class="required">*</span>
            </label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" id="existing-cv" name="currentWork" value="existing-cv" formControlName="currentWork"
                  (change)="onSelectExistingCV()">
                <span class="radio-label">USE EXISTING CV</span>
              </label>
              <label class="radio-option">
                <input type="radio" id="upload-cv" name="currentWork" value="upload-cv" formControlName="currentWork"
                  (change)="newselectedCv()">
                <span class="radio-label">UPLOAD NEW CV</span>
              </label>
            </div>

            <!-- CV Details Container - Both options in one line -->
            <div class="cv-details-container">
              <!-- Existing CV Details -->
              <div *ngIf="selectedCV" class="cv-details">
                <div class="cv-info">
                  <h6>Existing CV Details</h6>
                  <p><strong>CV Name:</strong> {{selectedCV?.name}}</p>
                  <a [href]="selectedCV?.url" target="_blank" class="btn btn-info">
                    <i class="fas fa-download"></i>
                    Download CV
                  </a>
                </div>
              </div>

              <!-- New CV Upload -->
              <div *ngIf="newCV" class="file-upload">
                <div class="upload-info">
                  <h6>Upload new CV</h6>
                  <div class="file-input-wrapper">
                    <input type="file" id="file-upload" aria-label="file example" class="file-input" (change)="fileUpload($event)"
                      accept=".doc, .docx,.pdf">
                    <label for="file-upload" class="file-label">
                      <i class="fas fa-cloud-upload-alt"></i>
                      Choose File
                    </label>
                  </div>
                  <p class="file-hint">Supported formats: .doc, .docx, .pdf</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Work Preferences Section -->
        <div class="form-section">
          <div class="form-group">
            <label class="form-label">
              Work Preferences <span class="required">*</span>
            </label>
            <div class="checkbox-group">
              <label class="checkbox-option">
                <input type="checkbox" name="roles" value="Remote Only with Informed client travel"
                  (change)="onCheckboxWorkPReference($event)"
                  [checked]="selectedWorkPreference('Remote Only with Informed client travel')">
                <span class="checkbox-label">Remote Only with Informed client travel</span>
              </label>
              <label class="checkbox-option">
                <input type="checkbox" name="roles" value="Remote only - No client tavel"
                  (change)="onCheckboxWorkPReference($event)"
                  [checked]="selectedWorkPreference('Remote only - No client tavel')">
                <span class="checkbox-label">Remote only - No client travel</span>
              </label>
              <label class="checkbox-option">
                <input type="checkbox" name="roles" value="Full time at client site"
                  (change)="onCheckboxWorkPReference($event)"
                  [checked]="selectedWorkPreference('Full time at client site')">
                <span class="checkbox-label">Full time at client site</span>
              </label>
              <label class="checkbox-option">
                <input type="checkbox" name="roles" value="Hybrid" (change)="onCheckboxWorkPReference($event)"
                  [checked]="selectedWorkPreference('Hybrid')">
                <span class="checkbox-label">Hybrid</span>
              </label>
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="form-actions">
          <button type="button" (click)="submitResources()" class="btn btn-primary submit-btn"
                  [disabled]="submitRes">
            <span *ngIf="!submitRes">Submit</span>
            <span *ngIf="submitRes">
              <i class="fas fa-spinner fa-spin"></i>
              Submitting...
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>
</ng-template>
