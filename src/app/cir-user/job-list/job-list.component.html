<div class="job-list-container">
  <div class="header">
    <div class="header-content">
      <h2>{{projectName ? projectName + ' - Jobs' : 'Jobs'}}</h2>
      <div class="project-info" *ngIf="projectDetails">
        <div class="project-details">
          <span class="project-client">{{projectDetails.client}}</span>
          <span class="project-location">{{projectDetails.clientLocation}}</span>
          <span class="project-type">{{projectDetails.workType}}</span>
        </div>
      </div>
    </div>
    <!-- <button class="add-button">Add New Job</button> -->
  </div>

  <div class="search-filter">
    <input type="text" placeholder="Search jobs..." class="search-input" [(ngModel)]="searchText" (input)="searchtext()">
    <select class="filter-select" [(ngModel)]="selectedStatus" (change)="searchtext()">
      <option value="">All Job Types</option>
      <option *ngFor="let status of statusList" [value]="status">{{status}}</option>
    </select>
    <select class="filter-select" [(ngModel)]="selectedFilterStatus" (change)="applyStatusFilter()">
      <option value="">All Status</option>
      <option value="Applied">Applied</option>
      <option value="Expired">Expired</option>
      <option value="Active">Active</option>
      <option value="Under Review">Under Review</option>
      <option value="Actioned">Actioned</option>
      <option value="Inactive">Inactive</option>
    </select>
  </div>

  <div class="table-container">
    <table class="jobs-table">
      <thead>
        <tr>
          <th>Job ID</th>
          <th>Job Title</th>
          <th>No. of Roles</th>
          <th>Publish Date</th>
          <th>Apply By</th>
          <th>Status</th>
          <th>Role Details</th>
          <th>Apply Job</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngIf="jobList.length == 0">
          <td colspan="7" class="text-center">No Record Found.</td>
        </tr>
        <tr *ngFor="let job of jobList | paginate: { itemsPerPage: pagesize, currentPage: page, totalItems: totalRecords }">
          <td>{{job.job_id}}</td>
          <td>{{job.job_title}}</td>
          <td>{{job.no_of_roles}}</td>
          <td>{{job.publish_date | date:'dd/MM/yyyy'}}</td>
          <td>
            <ng-container *ngIf="!job?.cirextendJobDetails?.job_expire_date">
              {{job?.jobExpireDate | date:'dd/MM/yyyy'}}
            </ng-container>
            <ng-container *ngIf="job?.cirextendJobDetails?.job_expire_date">
              {{job?.cirextendJobDetails?.job_expire_date | date:'dd/MM/yyyy'}}
            </ng-container>
          </td>
          <td>
            <span class="status-badge" [ngClass]="job.status?.toLowerCase().replace(' ', '-')">
              {{job.status}}
            </span>
          </td>
          <td> <a href="{{job?.upload?.url}}" target="_blank" class="action-btn read-me">Read Me</a></td>
          <td class="actions">
            <ng-container *ngIf="job.status !== 'Under Review'; else emailMessage">
              <div *ngIf="!job.applied">
                <button class="action-btn apply"
                  [disabled]="job.status === 'Applied' || job.status === 'Expired' || job.status === 'Inactive'"
                  (click)="openModal(job)">
                  Apply
                </button>
              </div>
              <div *ngIf="job.applied == true">
                <button class="action-btn upload"
                  [disabled]="job.status === 'Not Submitted'"
                  (click)="openCVModal(job)">
                  Upload CV
                </button>
              </div>
            </ng-container>
            <ng-template #emailMessage>
              <span class="email-message">Email CVs to: jamie.thompson@saivensolutions.co.uk</span>
            </ng-template>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="pagination">
    <pagination-controls (pageChange)="paginate($event)"></pagination-controls>
  </div>
</div>

<!-- Apply Job Modal -->
<ng-template class="modal" #loginDetailModal id="loginDetailModal" tabindex="-1" aria-labelledby="ViewLogin" aria-hidden="true">
  <div class="modal-header">
    <h5 class="modal-title" id="ViewLogin">Upload Details</h5>
    <button type="button" class="btn-close" (click)="closeModal()"></button>
  </div>
  <div class="modal-body">
    <form [formGroup]="resourcesForm">
      <div class="row">
        <div class="row mt-3">
          <div class="col-md-4">
            <label>Choose CV option: <span style="color: red;"> *</span></label>
          </div>
          <div class="col-md-8">
            <div class="form-group d-flex align-items-center">
              <label class="me-3">
                <input type="radio" id="1" name="currentWork" value="existing-cv" formControlName="currentWork"
                  (change)="onSelectExistingCV()">&nbsp;
                <span style="font-weight: normal;">USE EXISTING CV</span>
              </label>
              <label>
                <input type="radio" id="2" name="currentWork" value="upload-cv" formControlName="currentWork"
                  (change)="newselectedCv()">&nbsp;
                <span style="font-weight: normal;">UPLOAD NEW CV</span>
              </label>
            </div>

            <div *ngIf="selectedCV">
              <h5>Existing CV Details</h5>
              <p><strong>CV Name:</strong> {{selectedCV?.name}}</p>
              <a [href]="selectedCV?.url" target="_blank" class="btn btn-info">Download CV</a>
            </div>
            <div *ngIf="newCV" class="form-file">
              <h5>Upload new CV :</h5>
              <input type="file" aria-label="file example" class="form-control" (change)="fileUpload($event)"
                accept=".doc, .docx,.pdf">
            </div>
            <br>
          </div>

          <!-- Work Preferences -->
          <div class="row">
            <div class="col-md-4">
              <label>Work Preferences<span style="color: red">*</span> :</label>
            </div>
            <div class="col-md-8">
              <div class="form-group">
                <label>
                  <input type="checkbox" name="roles" value="Remote Only with Informed client travel"
                    (change)="onCheckboxWorkPReference($event)"
                    [checked]="selectedWorkPreference('Remote Only with Informed client travel')" />&nbsp;
                  <span style="font-weight: normal">Remote Only with Informed client travel</span>
                </label><br />
                <label>
                  <input type="checkbox" name="roles" value="Remote only - No client tavel"
                    (change)="onCheckboxWorkPReference($event)"
                    [checked]="selectedWorkPreference('Remote only - No client tavel')" />&nbsp;
                  <span style="font-weight: normal">Remote only - No client tavel</span>
                </label><br />
                <label>
                  <input type="checkbox" name="roles" value="Full time at client site"
                    (change)="onCheckboxWorkPReference($event)"
                    [checked]="selectedWorkPreference('Full time at client site')" />&nbsp;
                  <span style="font-weight: normal">Full time at client site</span>
                </label><br />
                <label>
                  <input type="checkbox" name="roles" value="Hybrid" (change)="onCheckboxWorkPReference($event)"
                    [checked]="selectedWorkPreference('Hybrid')" />&nbsp;
                  <span style="font-weight: normal">Hybrid</span>
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-3" style="float: right;">
        <div class="d-flex align-items-center justify-content-between" *ngIf="!submitRes">
          <button type="button" (click)="submitResources()" class="btn btn-primary w-50">Submit</button>
        </div>
      </div>
    </form>
  </div>
</ng-template>
